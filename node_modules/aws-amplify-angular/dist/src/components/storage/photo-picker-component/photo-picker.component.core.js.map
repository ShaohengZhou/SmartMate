{"version":3,"file":"photo-picker.component.core.js","sourceRoot":"","sources":["../../../../../src/components/storage/photo-picker-component/photo-picker.component.core.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, Output, EventEmitter } from '@angular/core';\nimport { AmplifyService } from '../../../providers/amplify.service';\n\nconst template = `\n<div class=\"amplify-photo-picker\">\n<div class=\"amplify-photo-picker-container\">\n  <div class=\"amplify-form-header\">Select Photos</div>\n  <div class=\"amplify-photo-picker-upload\" *ngIf=\"!hasPhoto\"></div>\n  <div class=\"amplify-photo-picker-preview\">\n    <img\n      class=\"amplify-photo-picker-preview\"\n      src=\"{{photoUrl}}\"\n      *ngIf=\"hasPhoto\"\n      (error)=\"onPhotoError()\"\n    />\n  </div>\n  <div class=\"amplify-upload-input\">\n    <input type=\"file\" \n      accept=\"image/*\"\n      (change)=\"pick($event)\"/>\n      <button \n        *ngIf=\"hasPhoto\" \n        class=\"amplify-form-button amplify-upload-button\" \n        (click)=\"uploadFile()\">\n        Upload Photo\n      </button>\n  </div>\n</div>\n<div class=\"amplify-alert\" *ngIf=\"errorMessage\">\n  <div class=\"amplify-alert-body\">\n    <span class=\"amplify-alert-icon\">&#9888;</span>\n    <div class=\"amplify-alert-message\">{{ errorMessage }}</div>\n    <a class=\"amplify-alert-close\" (click)=\"onAlertClose()\">&times;</a>\n  </div>\n</div>\n</div>\n`\n\n@Component({\n  selector: 'amplify-photo-picker-core',\n  template: template\n})\nexport class PhotoPickerComponentCore {\n  photoUrl: string;\n  path: string;\n  hasPhoto: boolean = false;\n  uploading: boolean = false;\n  s3ImagePath: string = \"\";\n  s3ImageFile: any = null;\n  errorMessage: string;\n  \n  @Input()\n  set url(url: string) {\n    this.photoUrl = url;\n    this.hasPhoto = true;\n  }\n\n  @Input()\n  set data(data: any) {\n    this.photoUrl = data.url;\n    this.path = data.path;\n    this.hasPhoto = true;\n  }\n\n  @Output()\n  picked: EventEmitter<string> = new EventEmitter<string>();\n\n  @Output()\n  loaded: EventEmitter<string> = new EventEmitter<string>();\n  \n  @Output()\n  uploaded: EventEmitter<Object> = new EventEmitter<Object>();\n\n  constructor( private amplify: AmplifyService ) {}\n\n  pick(evt) {\n    const file = evt.target.files[0];\n    if (!file) { return; }\n\n    const { name, size, type } = file;\n    this.picked.emit(file);\n\n    this.s3ImagePath = `${this.path}/${file.name}`;\n    this.s3ImageFile = file;\n    const that = this;\n    const reader = new FileReader();\n    reader.onload = function(e) {\n      const target: any = e.target;\n      const url = target.result;\n      that.photoUrl = url;\n      that.hasPhoto = true;\n      that.loaded.emit(url);\n    }\n    reader.readAsDataURL(file);\n  }\n\n  uploadFile() {\n  \tthis.uploading = true;\n  \tthis.amplify.storage().put( \n  \t\t\tthis.s3ImagePath, \n  \t\t\tthis.s3ImageFile, {\n    \t\t\t'contentType': this.s3ImageFile.type\n\t\t})\n\t\t.then ( result => {\n      this.uploaded.emit(result);\n\t\t\tthis.completeFileUpload();\n\t\t})\n\t\t.catch( error => {\n\t\t\tthis.completeFileUpload(error);\n\t\t});\n  }\n\n  completeFileUpload(error?:any) {\n  \tif (error) {\n  \t\treturn this._setError(error);\n  \t}\n  \tthis.s3ImagePath = \"\";\n  \tthis.s3ImageFile = null;\n\t  this.uploading = false;\n  }\n\n  onPhotoError() {\n    this.hasPhoto = false;\n  }\n\n  onAlertClose() {\n    this._setError(null);\n  }\n\n  _setError(err) {\n    if (!err) {\n      this.errorMessage = null;\n      return;\n    }\n    this.errorMessage = err.message || err;\n  }\n}\n"]}